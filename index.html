<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase掲示板</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f7f7f7;
        }
        h1 {
            text-align: center;
        }
        .post-form {
            margin-bottom: 30px;
        }
        .post-form input, .post-form textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            box-sizing: border-box;
        }
        .post-form button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }
        .posts {
            margin-top: 30px;
        }
        .post {
            background-color: white;
            padding: 20px;
            margin-bottom: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .post img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>

<h1>Firebase掲示板</h1>

<div class="post-form">
    <input type="text" id="username" placeholder="名前を入力" required>
    <textarea id="message" placeholder="メッセージを入力" required></textarea>
    <input type="text" id="imageUrl" placeholder="画像URLを入力 (任意)">
    <button onclick="submitPost()">投稿</button>
</div>

<div class="posts" id="posts"></div>

<!-- Firebase SDK -->
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCXVKtN_ndAqLVhnF1c6GSdDpVgMCiIDnU",
    authDomain: "keijiban-free.firebaseapp.com",
    databaseURL: "https://keijiban-free-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "keijiban-free",
    storageBucket: "keijiban-free.appspot.com",
    messagingSenderId: "830980234962",
    appId: "1:830980234962:web:45292491feee59cfd1970b",
    measurementId: "G-HP7ZZYT8KB"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  function submitPost() {
      const username = document.getElementById('username').value;
      const message = document.getElementById('message').value;
      const imageUrl = document.getElementById('imageUrl').value;

      if (username === '' || message === '') {
          alert('名前とメッセージを入力してください。');
          return;
      }

      const postRef = push(ref(database, 'posts'));
      postRef.set({
          username,
          message,
          imageUrl,
          timestamp: new Date().toLocaleString()
      });

      clearForm();
  }

  function loadPosts() {
      const postsRef = ref(database, 'posts');
      onChildAdded(postsRef, (data) => {
          const post = data.val();
          addPostToDOM(post);
      });
  }

  function addPostToDOM(post) {
      const postsDiv = document.getElementById('posts');
      const postDiv = document.createElement('div');
      postDiv.classList.add('post');
      
      const postHTML = `
          <p><strong>${post.username}</strong> (${post.timestamp})</p>
          <p>${post.message}</p>
          ${post.imageUrl ? `<img src="${post.imageUrl}" alt="投稿画像">` : ''}
      `;
      postDiv.innerHTML = postHTML;
      postsDiv.appendChild(postDiv);
  }

  function clearForm() {
      document.getElementById('username').value = '';
      document.getElementById('message').value = '';
      document.getElementById('imageUrl').value = '';
  }

  // Initialize the posts loading
  loadPosts();

</script>

</body>
</html>
